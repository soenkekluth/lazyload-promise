<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Lazyload</title>
  <style>

    #output{
      position: absolute;
      padding: 1em;
      left: 0;
      top: 0;
      width: 300px;
      height: 100%;
    }

    #container{
      margin-left: 330px;
    }
  </style>
</head>

<body>
  <div id="container">
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&1" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&2" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&3" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&4" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&5" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&6" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&7" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&8" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&9" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&10" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&11" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&12" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&13" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&14" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&15" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&16" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&17" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&18" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&19" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&20" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&21" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&22" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&23" />
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" data-src="https://unsplash.it/200/300/?random&24" />
  </div>
  <div id="output">
    <h2>loaded images ordered and displayed by load event:</h2>
    <ul id="onload">
    </ul>
    <div id="message">
    </div>
  </div>
  <script src="lazyload-promise.min.js"></script>
  <script>
  var container = document.querySelector('#container');
  var message = document.querySelector('#message');
  var onload = document.querySelector('#onload');

  const onImage = (img) => {
    const li = document.createElement('li');
    li.innerHTML = img.src;
    onload.appendChild(li);
  }

  lazyload(container, {
    onLoad: onImage,
    setSource: (src) => {
      src = src.replace('200/300', Math.round(Math.random()*400 + 100)+'/'+Math.round(Math.random()*400 + 100));
      return src;
    }
  }).then((images) => {
    message.innerHTML = '<h1>load complete</h1><h2>result is ordered the same as input</h2> <ul><li>' + images.map(img => img.src).join('</li><li>') + '</ul>';
  });
  </script>
</body>

</html>
